/*! maska v2.1.9 | (c) Alexander Shabunevich | Released under the MIT license */
!function(t,e){"object"==typeof exports&&typeof module<"u"?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=typeof globalThis<"u"?globalThis:t||self).Maska={})}(this,(function(t){"use strict";var e=Object.defineProperty,s=(t,s,n)=>(((t,s,n)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n})(t,"symbol"!=typeof s?s+"":s,n),n);const n={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class a{constructor(t={}){s(this,"opts",{}),s(this,"memo",new Map);const e={...t};if(null!=e.tokens){e.tokens=e.tokensReplace?{...e.tokens}:{...n,...e.tokens};for(const t of Object.values(e.tokens))"string"==typeof t.pattern&&(t.pattern=new RegExp(t.pattern))}else e.tokens=n;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((t,e)=>t.length-e.length):e.mask=e.mask[0]??""),""===e.mask&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return!0===this.opts.eager}isReversed(){return!0===this.opts.reversed}completed(t){const e=this.findMask(t);if(null==this.opts.mask||null==e)return!1;const s=this.process(t,e).length;return"string"==typeof this.opts.mask?s>=this.opts.mask.length:"function"==typeof this.opts.mask?s>=e.length:this.opts.mask.filter(t=>s>=t.length).length===this.opts.mask.length}findMask(t){const e=this.opts.mask;if(null==e)return null;if("string"==typeof e)return e;if("function"==typeof e)return e(t);const s=this.process(t,e.slice(-1).pop()??"",!1);return e.find(e=>this.process(t,e,!1).length>=s.length)??""}escapeMask(t){const e=[],s=[];return t.split("").forEach((n,a)=>{"!"===n&&"!"!==t[a-1]?s.push(a-s.length):e.push(n)}),{mask:e.join(""),escaped:s}}process(t,e,s=!0){var n;if(null==e)return t;const a=`value=${t},mask=${e},masked=${s?1:0}`;if(this.memo.has(a))return this.memo.get(a);const{mask:i,escaped:o}=this.escapeMask(e),r=[],l=null!=this.opts.tokens?this.opts.tokens:{},p=this.isReversed()?-1:1,u=this.isReversed()?"unshift":"push",h=this.isReversed()?0:i.length-1,d=this.isReversed()?()=>f>-1&&g>-1:()=>f<i.length&&g<t.length,c=t=>!this.isReversed()&&t<=h||this.isReversed()&&t>=h;let m,k=-1,f=this.isReversed()?i.length-1:0,g=this.isReversed()?t.length-1:0;for(;d();){const e=i.charAt(f),a=l[e],d=null!=(null==a?void 0:a.transform)?a.transform(t.charAt(g)):t.charAt(g);if(o.includes(f)||null==a)s&&!this.isEager()&&r[u](e),d!==e||this.isEager()?m=e:g+=p,this.isEager()||(f+=p);else{if(null!=d.match(a.pattern))r[u](d),a.repeated?(-1===k?k=f:f===h&&f!==k&&(f=k-p),h===k&&(f-=p)):a.multiple&&(f-=p),f+=p;else if(a.multiple){const t=null!=(null==(n=r[g-p])?void 0:n.match(a.pattern)),e=i.charAt(f+p);t&&""!==e&&null==l[e]?(f+=p,g-=p):r[u]("")}else d===m?m=void 0:a.optional&&(f+=p,g-=p);g+=p}if(this.isEager())for(;c(f)&&(null==l[i.charAt(f)]||o.includes(f));)s?r[u](i.charAt(f)):i.charAt(f)===t.charAt(g)&&(g+=p),f+=p}return this.memo.set(a,r.join("")),this.memo.get(a)}}const i=t=>JSON.parse(t.replaceAll("'",'"')),o=(t,e={})=>{const s={...e};return null!=t.dataset.maska&&""!==t.dataset.maska&&(s.mask=l(t.dataset.maska)),null!=t.dataset.maskaEager&&(s.eager=r(t.dataset.maskaEager)),null!=t.dataset.maskaReversed&&(s.reversed=r(t.dataset.maskaReversed)),null!=t.dataset.maskaTokensReplace&&(s.tokensReplace=r(t.dataset.maskaTokensReplace)),null!=t.dataset.maskaTokens&&(s.tokens=p(t.dataset.maskaTokens)),s},r=t=>""===t||!!JSON.parse(t),l=t=>t.startsWith("[")&&t.endsWith("]")?i(t):t,p=t=>{if(t.startsWith("{")&&t.endsWith("}"))return i(t);const e={};return t.split("|").forEach(t=>{const s=t.split(":");e[s[0]]={pattern:new RegExp(s[1]),optional:"optional"===s[2],multiple:"multiple"===s[2],repeated:"repeated"===s[2]}}),e};class u{constructor(t,e={}){s(this,"items",new Map),s(this,"beforeinputEvent",t=>{const e=t.target,s=this.items.get(e);s.isEager()&&"inputType"in t&&t.inputType.startsWith("delete")&&s.unmasked(e.value).length<=1&&this.setMaskedValue(e,"")}),s(this,"inputEvent",t=>{if(t instanceof CustomEvent&&"input"===t.type&&null!=t.detail&&"object"==typeof t.detail&&"masked"in t.detail)return;const e=t.target,s=this.items.get(e),n=e.value,a=e.selectionStart,i=e.selectionEnd;let o=n;if(s.isEager()){const e=s.masked(n),a=s.unmasked(n);""===a&&"data"in t&&null!=t.data?o=t.data:a!==s.unmasked(e)&&(o=a)}if(this.setMaskedValue(e,o),"inputType"in t&&(t.inputType.startsWith("delete")||null!=a&&a<n.length))try{e.setSelectionRange(a,i)}catch{}}),this.options=e,"string"==typeof t?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(e)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(e))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,e){const s=this.items.get(t),n=new a(o(t,this.getMaskOpts(e)));return JSON.stringify(s.opts)!==JSON.stringify(n.opts)}needUpdateValue(t){const e=t.dataset.maskaValue;return null==e&&""!==t.value||null!=e&&e!==t.value}getMaskOpts(t){const{onMaska:e,preProcess:s,postProcess:n,...a}=t;return a}init(t,e){for(const s of t){const t=new a(o(s,e));this.items.set(s,t),""!==s.value&&this.setMaskedValue(s,s.value),s.addEventListener("input",this.inputEvent),s.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,e){const s=this.items.get(t);null!=this.options.preProcess&&(e=this.options.preProcess(e));const n=s.masked(e),a={masked:n,unmasked:s.unmasked(s.isEager()?n:e),completed:s.completed(e)};e=n,null!=this.options.postProcess&&(e=this.options.postProcess(e)),t.value=e,t.dataset.maskaValue=e,null!=this.options.onMaska&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(t=>t(a)):this.options.onMaska(a)),t.dispatchEvent(new CustomEvent("maska",{detail:a})),t.dispatchEvent(new CustomEvent("input",{detail:a}))}}const h=new WeakMap;t.Mask=a,t.MaskInput=u,t.tokens=n,t.vMaska=(t,e)=>{const s=t instanceof HTMLInputElement?t:t.querySelector("input"),n={...e.arg};if(null==s)return;(t=>{setTimeout(()=>{var e;!0===(null==(e=h.get(t))?void 0:e.needUpdateValue(t))&&t.dispatchEvent(new CustomEvent("input"))})})(s);const a=h.get(s);if(null!=a){if(!a.needUpdateOptions(s,n))return;a.destroy()}if(null!=e.value){const t=e.value,s=e=>{t.masked=e.masked,t.unmasked=e.unmasked,t.completed=e.completed};n.onMaska=null==n.onMaska?s:Array.isArray(n.onMaska)?[...n.onMaska,s]:[n.onMaska,s]}h.set(s,new u(s,n))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));